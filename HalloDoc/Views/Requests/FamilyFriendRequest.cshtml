@using Common.Helper;
@{
    Layout = "_Requests";
}
@model Services.ViewModels.FamilyFriendRequest;

<div class="container mt-3">
    <div class="d-flex justify-content-between">
        <div>
            <h3 class="none">Submit Information</h3>
        </div>
        <div>
            <button class=" border border-info rounded-2 p-2 bg-transparent">
                <a class="text-decoration-none text-info " asp-controller="Home" asp-action="PatientRequestScreen">&lt; Back</a>
            </button>
        </div>
    </div>

    <div class="container border rounded-2 p-3 pr_main bg-white mt-3" id="main-content">

             <form asp-action="FamilyInsert" asp-controller="Requests" method="post" enctype="multipart/form-data" id="myForm">
            <div class="relative-info row mt-3">

                <div class="h4">Family/friend Information</div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for="FirstName" id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Your First Name</label>
                    <span asp-validation-for="FirstName" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for="LastName" id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Your Last Name</label>
                    <span asp-validation-for="LastName" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" id="phone" class="form-control" asp-for="Mnumber" />
                    <span asp-validation-for="Mnumber" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="email" class="form-control" asp-for="Email" id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Your Email</label>
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for="Relation" id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Relation With Patient</label>
                    <span asp-validation-for="Relation" class="text-danger"></span>
                </div>

            </div>

            <div class="patient-info row mt-5">

                <div class="h4">Patient information</div>

                <div class="form-floating mt-3 col-xl-12">
                    <textarea class="form-control" asp-for="Symptoms" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
                    <label for="floatingTextarea2" style="left: 5px;">Enter Brief Details Of Symptoms(Optional)</label>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for="PatientFirstName" id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">First Name</label>
                    <span asp-validation-for="PatientFirstName" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for="PatientLastName" id="floatingPassword" placeholder="Password">
                    <label for="floatingPassword" style="left: 5px;">Last Name</label>
                    <span asp-validation-for="PatientLastName" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="date" class="form-control" asp-for="DOB" id="floatingPassword" placeholder="Password" max="@DateTime.Now.ToString("yyyy-MM-dd")">
                    <label for="floatingPassword" style="left: 5px;">Date of Birth</label>
                    <span asp-validation-for="DOB" class="text-danger"></span>
                </div>

            </div>

            <div class="contact-info row mt-5">

                <div class="h4">Patient contact information</div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="email" class="form-control" asp-for="PatientEmail" placeholder="name@example.com" id="email">
                    <label for="floatingInput" style="left: 5px;">Email</label>
                    <span asp-validation-for="PatientEmail" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" id="phone1" class="form-control" asp-for=PatientMobileNumber maxlength="10"/>
                    <span asp-validation-for=PatientMobileNumber class="text-danger"></span>
                </div>

            </div>

            <div class="location-info row mt-5">

                <div class="h4">Patient Location</div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for=Street id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Street</label>
                    <span asp-validation-for="Street" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for=City id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">City</label>
                    <span asp-validation-for="City" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for=State id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">State</label>
                    <span asp-validation-for="State" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for=ZipCode id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Zip Code</label>
                    <span asp-validation-for="ZipCode" class="text-danger"></span>
                </div>

                <div class="form-floating mt-3 col-xl-6 col-sm-6 col-12">
                    <input type="text" class="form-control" asp-for=Room id="floatingInput" placeholder="name@example.com">
                    <label for="floatingInput" style="left: 5px;">Room # / Suite(Optional)</label>
                </div>

            </div>

            <div class="document row mt-5">

                <div class="h4">(Optional) Upload photo or Document</div>

                <div class="row d-flex mt-3">
                    <div class="py-2 col-12 ">
                        <div class="form-group rounded d-flex align-items-center justify-content-between border border-1 bg-body-secondary">
                            <div class="px-3 table-responsive">
                                <input type="file" id="upload" asp-for="Upload" multiple hidden />
                                <label id="file-choosen" class="choosenfile text-nowrap text-secondary">No item selected</label>
                            </div>
                            <div class="uploadbtn px-2 py-1 d-flex ms-1 border-0 rounded-2 btn-info">
                                <label for="upload" role="button" class="d-flex align-items-center"><i class="bi bi-cloud-arrow-up p-2"></i><div class="d-none d-sm-block">Upload</div></label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="button" class="bg-info p-2 rounded border-0 px-3 text-white" id="submitBtn">Submit</button>
                    <button class="ms-3 p-2 rounded border-info bg-white text-info px-3" type="reset" id="cancelBtn">Cancel</button>
                </div>

            </div>
        </form>
    </div>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
    const phoneInputField = document.querySelector("#phone");
    const phoneInput = window.intlTelInput(phoneInputField, {
        utilsScript:
            "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    });
    const phoneInputField1 = document.querySelector("#phone1");
    const phoneInput1 = window.intlTelInput(phoneInputField1, {
        utilsScript:
            "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    });
    new swal("Information",
        "When Submitting the request, you must provide the correct contact information for the patient or responsibly party.Failure to provide the correct email and phone number will delay the service or be declined.",
        "warning", {
        closeOnClickOutside: true,
    });


    $('#submitBtn').on('click', function () {
        $('form span').css('display', 'flex');
    var Email = $('#email').val();
        if ($('#myForm').valid()) {
            $.ajax({
                url: '/Requests/EmailValidate',
                data: { "Email" : Email },
                async: false,
                success: function (response) {
                    if (response) {
                        document.getElementById('submitBtn').type = "submit";
                        $('#submitBtn').click();
                    } else {
                        $.ajax({
                            url: '/Requests/CreateNewAccountLink',
                            data: { email: Email },
                            async: false,
                            success: function (data) {
                                Swal.fire({
                                    icon: "warning",
                                    title: "User Not Exist",
                                    text: "Link is sent to patient email to create account. First Create account and then submit this form."
                                });
                            }
                        });
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            })
        }
    });

    $('#cancelBtn').on('click', function () {
        $('form span').css('display', 'none');
    })

</script>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>